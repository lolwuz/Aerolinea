<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">

    <title>Aerol√≠nea</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="css/styles.css">
</head>

<body>

    <div style="position: absolute;">
        <div class="card" style="width: 20rem; opacity: 0.8;">
            <img id="AirportImg" class="card-img-top" src="..." alt="Card image cap">
            <div class="card-body">
                <h4 id="Airport">Airport Name</h4>
                <p id="AirportInfo" class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
                <a href="#" class="btn btn-primary">Buy landing rights</a>
            </div>
        </div>
    </div>




    <canvas id="gameCanvas"></canvas>

    <script src="javascript/three.js"></script>
    <script src="javascript/controls/OrbitControls.js"></script>
    <script src="javascript/OBJLoader.js"></script>
    <script src="javascript/MTLLoader.js"></script>
    <script src="javascript/OBJMTLLoader.js"></script>
    <script src="objects/Scene.js"></script>
    <script src="objects/World.js"></script>
    <script src="objects/Airport.js"></script>
    <script src="objects/Airplane.js"></script>
    <script>
        var scene;
        var raycaster = new THREE.Raycaster();
        var mouse = new THREE.Vector2();

        init();
        animate();

        function init() {
            scene = new Scene();
            window.addEventListener('resize', onWindowResize, false);
            window.addEventListener( 'click', onMouseClick, false );

            for (let i=0; i< scene.children[0].children.length; i++) {
                if(scene.children[0].children[i].constructor.name === "Airport"){
                    console.log(scene.children[0].children[i].info.name);
                    // document.getElementById("AirportList").innerHTML += "<a href=\"#\" class=\"list-group-item list-group-item-action\">" + scene.children[0].children[i].info.name + "</a>";
                }
            }
        }

        function animate() {

            requestAnimationFrame(animate);
            scene.update();

        }

        function onWindowResize() {

            scene.camera.aspect = window.innerWidth / window.innerHeight;
            scene.camera.updateProjectionMatrix();
            scene.renderer.setSize(window.innerWidth, window.innerHeight);

        }

        function onMouseClick( event ) {
            // calculate mouse position in normalized device coordinates
            // (-1 to +1) for both components
            console.log("Clicked");
            mouse.x = ( event.clientX / window.innerWidth ) * 2 - 1;
            mouse.y = - ( event.clientY / window.innerHeight ) * 2 + 1;

            // update the picking ray with the camera and mouse position
            raycaster.setFromCamera( mouse.clone(), scene.camera );

            // calculate objects intersecting the picking ray
            let intersects = raycaster.intersectObjects( scene.children[0].children );

            for ( let i = 0; i < intersects.length; i++ ) {
                console.log(intersects[i].object);
                if(intersects[i].object.constructor.name === "Airport"){
                    console.log(intersects[i].object.info.name);
                    document.getElementById("Airport").innerText = intersects[i].object.info.name;
                    document.getElementById("AirportInfo").innerText = intersects[i].object.info;
                    document.getElementById("AirportImg").src="https://maps.googleapis.com/maps/api/staticmap?center="+ intersects[i].object.info.lat + "," + intersects[i].object.info.lon + "&zoom=8&size=400x250&key=AIzaSyCaqRZpDr07TXFnlyLr6ZOKJYCwwpBTbW0";

                }
            }
        }
    </script>
</body>

</html>
